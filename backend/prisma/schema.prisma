generator client {
  provider = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// User management
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  avatar    String?
  status    String   @default("offline")
  latitude  Float?
  longitude Float?
  city      String?
  country   String?
  createdAt DateTime @default(now())

  chatSessions ChatSession[]
  ailocks      Ailock[]
  intents      Intent[]
}

// Ailock Agent
model Ailock {
  id        String   @id @default(cuid())
  name      String
  mode      String   @default("creator") // researcher, creator, analyst
  owner     User     @relation(fields: [ownerId], references: [id])
  ownerId   String
  createdAt DateTime @default(now())
}

// Ailock sessions for tracking active interactions
model AilockSession {
  id           String   @id @default(cuid())
  userId       String
  mode         String   @default("researcher")
  location     String?
  contextData  String?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  lastActivity DateTime @default(now())
}

// Chat sessions
model ChatSession {
  id           String   @id @default(cuid())
  user         User     @relation(fields: [userId], references: [id])
  userId       String
  ailockMode   String   @default("creator")
  createdAt    DateTime @default(now())
  lastActivity DateTime @default(now())

  messages ChatMessage[]
  intents  Intent[]
}

model ChatMessage {
  id        String      @id @default(cuid())
  session   ChatSession @relation(fields: [sessionId], references: [id])
  sessionId String
  sender    String // 'user' or 'ailock'
  content   String
  timestamp DateTime    @default(now())
}

// Core business entities
model Intent {
  id          String       @id @default(cuid())
  user        User         @relation(fields: [userId], references: [id])
  userId      String
  session     ChatSession? @relation(fields: [sessionId], references: [id])
  sessionId   String?
  title       String
  description String
  category    String
  status      String       @default("draft") // draft, active, matched, completed
  createdAt   DateTime     @default(now())
}